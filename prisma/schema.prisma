generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Product {
  id             String   @id @default(uuid()) @db.Char(36)
  name           String
  sku            String   @unique
  cost           Decimal  @db.Decimal(10,2)
  category       String?  @db.VarChar(191)
  uom            String?  @db.VarChar(64)
  min_stock_level Int     @default(0) @db.UnsignedInt
  current_stock   Int     @default(0) @db.UnsignedInt
  created_at     DateTime @default(now()) @db.Timestamp(6)
  updated_at     DateTime @updatedAt @db.Timestamp(6)

  OperationItem  OperationItem[]
  StockMove      StockMove[]
}

enum OperationType {
  INCOMING
  OUTGOING
  INTERNAL
  ADJUSTMENT
}

enum OperationStatus {
  DRAFT
  WAITING
  READY
  DONE
  CANCELED
}

model Operation {
  id                  String          @id @default(uuid()) @db.Char(36)
  reference           String?         @unique
  type                OperationType
  partner             String
  schedule_date       DateTime        @db.Timestamp(6)
  source_location     String
  destination_location String
  status              OperationStatus @default(DRAFT)
  created_at          DateTime        @default(now()) @db.Timestamp(6)
  updated_at          DateTime        @updatedAt @db.Timestamp(6)

  items OperationItem[]
}

model OperationItem {
  id           String   @id @default(uuid()) @db.Char(36)
  product_id   String   @db.Char(36)
  qty          Decimal  @db.Decimal(10,2)
  done_qty     Decimal  @default(0) @db.Decimal(10,2)

  product   Product  @relation(fields: [product_id], references: [id])
  operation Operation @relation(fields: [operation_id], references: [id])
  operation_id String @db.Char(36)
}

model StockMove {
  id             String    @id @default(uuid()) @db.Char(36)
  date           DateTime  @default(now()) @db.Timestamp(6)
  product_id     String    @db.Char(36)
  qty            Decimal   @db.Decimal(10,2)
  from_location  String
  to_location    String
  reference_doc  String
  status         OperationStatus
  created_at     DateTime  @default(now()) @db.Timestamp(6)

  product Product @relation(fields: [product_id], references: [id])
}

model Warehouse {
  id         String   @id @default(uuid()) @db.Char(36)
  name       String   @unique
  created_at DateTime @default(now()) @db.Timestamp(6)

  locations Location[]
}

model Location {
  id           String    @id @default(uuid()) @db.Char(36)
  warehouse_id String    @db.Char(36)
  name         String
  created_at   DateTime  @default(now()) @db.Timestamp(6)

  warehouse Warehouse @relation(fields: [warehouse_id], references: [id])
}